#! /bin/bash
temp_run=$(sqlite3 $dir/dbf/nettemp.db "SELECT temp_run FROM gpio WHERE gpio='$gpio'")
if [ "$temp_run" = "on" ]; then

for i in 1
    do 

declare temp_onoff$i=`sqlite3 $dir/dbf/nettemp.db "SELECT temp_onoff$i FROM gpio WHERE gpio='$gpio'"`
declare temp_temp$i=`sqlite3 $dir/dbf/nettemp.db "SELECT temp_temp$i FROM gpio WHERE gpio='$gpio'"`
declare temp_sensor$i=`sqlite3 $dir/dbf/nettemp.db "SELECT temp_sensor$i FROM gpio WHERE gpio='$gpio'"`
declare sensor_temp$i=`sqlite3 $dir/dbf/nettemp.db "SELECT tmp FROM sensors WHERE id='$temp_sensor$i'"`
declare sensor_name$i=`sqlite3 $dir/dbf/nettemp.db "SELECT name FROM sensors WHERE id='$temp_sensor$i'"`
declare temp_op$i=`sqlite3 $dir/dbf/nettemp.db "SELECT temp_op$i FROM gpio WHERE gpio='$gpio'"`

temp_onoff=temp_onoff$i
temp_temp=temp_temp$i
temp_sensor=temp_sensor$i
sensor_temp=sensor_temp$i
sensor_name=sensor_name$i
temp_op=temp_op$i

        if [ "${!temp_op}" = "gt" ]; then
    gt=$(echo ${!sensor_temp} ${!temp_temp} | awk '{if ($1 > $2) print 1; else print 0 }') 
    if [ "$gt" = "1" ];then
        if [ "${!temp_onoff}" = "on" ];then
            gpio_on $gpio
	echo "${!sensor_name} ${!sensor_temp} &deg;C is greater than ${!temp_temp} &deg;C - gpio is ON"
        else
            gpio_off $gpio
	    echo "${!sensor_name} ${!sensor_temp} &deg;C is greater than ${!temp_temp} &deg;C - gpio is OFF"
        fi
    else
        if [ "$temp_onoff" = "on" ];then
            gpio_off $gpio
            echo "${!sensor_name} ${!sensor_temp} &deg;C is less than {!$temp_temp} &deg;C - gpio is OFF"
        else
            gpio_on $gpio
	    echo "${!sensor_name} ${!sensor_temp} &deg;C is less than ${!temp_temp} &deg;C - gpio is ON"
        fi
    fi
    
        fi
        if [ "${!temp_op}" = "ge" ]; then
    ge=$(echo ${!sensor_temp} ${!temp_temp} | awk '{if ($1 >= $2) print 1; else print 0 }') 
    if [ "$ge" = "1" ];then
        if [ "${temp_onoff}" = "on" ];then
            gpio_on $gpio
	echo "${!sensor_name} ${!sensor_temp} &deg;C is greather or equal to ${!temp_temp} &deg;C - gpio is ON"
        else
            gpio_off $gpio
	    echo "${!sensor_name} ${!sensor_temp} &deg;C is greather or equal to ${!temp_temp} &deg;C - gpio is OFF"
        fi
    else
        if [ "${!temp_onoff}" = "on" ];then
            gpio_off $gpio
            echo "${!sensor_name} ${sensor_temp} &deg;C is less than or equal to ${!temp_temp} &deg;C - gpio is OFF"
        else
            gpio_on $gpio
	    echo "${!sensor_name} ${!sensor_temp} &deg;C is less than or equal to ${!temp_temp} &deg;C - gpio is ON"
        fi
    fi
        fi
        if [ "${!temp_op}" = "le" ]; then
    le=$(echo ${!sensor_temp} ${!temp_temp} | awk '{if ($1 <= $2) print 1; else print 0 }') 
    if [ "$le" = "1" ];then
        if [ "${!temp_onoff}" = "on" ];then
            gpio_on $gpio
	echo "${!sensor_name} ${!sensor_temp} &deg;C is less than or equal to ${!temp_temp} &deg;C - gpio is ON"
        else
            gpio_off $gpio
	    echo "${!sensor_name} ${!sensor_temp} &deg;C is less than or equal to ${!temp_temp} &deg;C - gpio is OFF"
        fi
    else
        if [ "${!temp_onoff}" = "on" ];then
            gpio_off $gpio
            echo "${!sensor_name{ ${!sensor_temp} &deg;C is greather or equal to ${!temp_temp} &deg;C - gpio is OFF"
        else
            gpio_on $gpio
	    echo "${!sensor_name} ${!sensor_temp} &deg;C is greather or equal to ${temp_temp} &deg;C - gpio is ON"
        fi
    fi
        fi
        if [ "${!temp_op}" = "lt" ]; then
    lt=$(echo ${!sensor_temp} ${!temp_temp} | awk '{if ($1 < $2) print 1; else print 0 }') 
    if [ "$lt" = "1" ];then
        if [ "${!temp_onoff}" = "on" ];then
            gpio_on $gpio
	echo "${!sensor_name} ${!sensor_temp}! &deg;C < ${!temp_temp} &deg;C - gpio is ON"
        else
            gpio_off $gpio
	    echo "${!sensor_name} ${!sensor_temp} &deg;C < ${!temp_temp} &deg;C - gpio is OFF"
        fi
    else
        if [ "${!temp_onoff}" = "on" ];then
            gpio_off $gpio
            echo "${!sensor_name} ${!sensor_temp} &deg;C > ${!temp_temp} &deg;C - gpio is OFF"
        else
            gpio_on $gpio
	    echo "${!sensor_name} ${!sensor_temp} &deg;C > ${!temp_temp} &deg;C - gpio is ON"
        fi
    fi
        fi

    done
fi #last 
