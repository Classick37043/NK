#! /bin/bash -x 
dir=../..

date=`date +%y%m%d-%H%M`

rm -rf $dir/dbf/nettemp.db
rm -rf $dir/db/*.rrd
rm -rf $dir/img/view1/*.png                                           
rm -rf $dir/img/instant/*.png                                         
rm -rf $dir/tmp/log.txt
rm -rf $dir/tmp/.digitemprc

sqlite3 $dir/dbf/nettemp.db  "CREATE TABLE sensors (
  id INTEGER PRIMARY KEY,
  name UNIQUE,
  rom UNIQUE,
  tmp float NOT NULL,
  tmp_min float NOT NULL,
  tmp_max float NOT NULL,
  alarm char(3) NOT NULL,
  hour char(3) NOT NULL,
  day char(3) NOT NULL,
  week char(3) NOT NULL,
  month char(3) NOT NULL,
  year char(3) NOT NULL,
  logoterma char(3) NOT NULL
  );"
 
sqlite3 $dir/dbf/nettemp.db "CREATE TABLE recipient (
  id INTEGER PRIMARY KEY,
  name TEXT,
  mail TEXT,
  tel NUMERIC,
  mail_alarm TEXT,
  sms_alarm TEXT
  );"
 
sqlite3 $dir/dbf/nettemp.db "CREATE TABLE users (
  id INTEGER PRIMARY KEY,
  login UNIQUE, 
  password TEXT, 
  perms TEXT
  );"

sqlite3 $dir/dbf/nettemp.db "CREATE TABLE mail_settings (
  id INTEGER PRIMARY KEY,
  host UNIQUE,
  port UNIQUE,
  user UNIQUE,
  password UNIQUE,
  address UNIQUE
  );" 

sqlite3 $dir/dbf/nettemp.db "CREATE TABLE device (
   id INTEGER PRIMARY KEY,
   temp UNIQUE
  );" 

sqlite3 $dir/dbf/nettemp.db "CREATE TABLE relays (
  id INTEGER PRIMARY KEY,
  gpio UNIQUE,
  name TEXT,
  time_settings TEXT,
  end_time TEXT
    );" 


sqlite3 $dir/dbf/nettemp.db "INSERT OR IGNORE INTO users (login, password, perms ) VALUES ('admin', 'd033e22ae348aeb5660fc2140aec35850c4da997', 'adm')"
sqlite3 $dir/dbf/nettemp.db "INSERT OR IGNORE INTO users (login, password, perms ) VALUES ('temp', 'd969831eb8a99cff8c02e681f43289e5d3d69664', 'ops')"
sqlite3 $dir/dbf/nettemp.db "INSERT INTO device (temp) VALUES ('no dev')"


chmod 777 $dir/dbf/nettemp.db
echo "Default settings restored" >> $dir/tmp/log.txt
chmod 777 $dir/tmp/log.txt
